---
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import { actions } from "astro:actions";
import ProjectsAnimation from "./animations/ProjectsAnimation";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const { data, error } = await Astro.callAction(actions.getProjectsPaginated, {
    limit: 50,
    offset: 0,
});

if (error) {
    throw new Error("Error getting projects", error);
}

const projects = data?.data ?? [];
---

<!-- altura ajustada para ajustarla al alto mas el navbar que es fixed -->
<section id="projects" class="projects-section min-h-[calc(100vh-4rem)]">
    <div class="text-gray-900 dark:text-white">
        <!-- titulo de la seccion Projects -->
        <p
            class="font-saira text-dark dark:text-white text-2xl font-bold text-center pt-10"
        >
            {t("projects.title")}
        </p>
        <!-- Showcase horizontal scroll -->
        <div class="projects-wrapper overflow-hidden w-full mt-10">
            <div class="projects-track flex">
                {
                    projects.map((project) => (
                        <div class="flex-shrink-0 w-full flex flex-col items-center justify-center space-y-4 px-4">
                            {project.mediaType === "video" ? (
                                <video
                                    src={project.mediaUrl}
                                    autoplay
                                    loop
                                    muted
                                    playsinline
                                    class="w-full h-[70vh] object-cover"
                                />
                            ) : (
                                <img
                                    src={project.mediaUrl}
                                    alt={project[`title_${lang}`]}
                                    class="w-full h-[70vh] object-cover"
                                />
                            )}
                            {project.projectUrl ? (
                                <a
                                    href={project.projectUrl}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="project-title font-saira text-xl md:text-2xl font-semibold hover:underline"
                                >
                                    {lang === "es"
                                        ? project.title_es
                                        : project.title_en}
                                </a>
                            ) : (
                                <p class="project-title font-saira text-xl md:text-2xl font-semibold">
                                    {lang === "es"
                                        ? project.title_es
                                        : project.title_en}
                                </p>
                            )}
                        </div>
                    ))
                }
            </div>
        </div>
        <ProjectsAnimation client:only="react" />
    </div>
</section>
