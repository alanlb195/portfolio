---
import { LuTableOfContents } from "react-icons/lu";
import TableOfContentPosition from "./animations/TableOfContentPosition";
import TableOfContentSkeleton from "./ui/TableOfContentSkeleton.astro";

interface Props {
  headings: { depth: number; slug: string; text: string }[];
}

const { headings = [] } = Astro.props;
const filteredHeadings = headings.filter((h) => h.depth === 1);
---

{filteredHeadings.length > 0 ? (
  <>
    <aside
      class="toc-fixed fixed top-20 hidden xl:flex flex-col gap-3 w-64 p-5 rounded-2xl
      bg-white/70 dark:bg-slate-700/60 
      backdrop-blur-xl border border-white/40 dark:border-white/10 
      text-sm z-[20] transition-all duration-300
      shadow-[0_0_25px_-5px_rgba(59,130,246,0.25)] opacity-0"
    >
      <h2
        class="text-[15px] font-semibold tracking-wide text-zinc-800 dark:text-zinc-100 
        flex items-center gap-2 border-b border-zinc-300/40 dark:border-zinc-700/60 
        pb-2 mb-2"
      >
        <LuTableOfContents className="w-4 h-4 text-blue-600 dark:text-blue-400" />
        Contenido
      </h2>

      <ul class="flex flex-col gap-1">
        {filteredHeadings.map((h) => (
          <li
            class={`transition-all ${h.depth === 3 ? "ml-3" : h.depth >= 4 ? "ml-6" : ""}`}
          >
            <a
              href={`#${h.slug}`}
              data-scroll={`#${h.slug}`}
              class="group flex items-center gap-2 rounded-md px-2 py-1.5
              text-zinc-700 dark:text-zinc-300 
              hover:text-blue-600 dark:hover:text-blue-400
              hover:bg-blue-100/50 dark:hover:bg-blue-900/30
              transition-all duration-200"
            >
              <span class="h-[6px] w-[6px] rounded-full bg-zinc-400/70 group-hover:bg-blue-500/70 transition-colors" />
              <span class="leading-snug">{h.text}</span>
            </a>
          </li>
        ))}
      </ul>
    </aside>

    <!-- React script que posiciona y muestra el TOC -->
    <TableOfContentPosition client:only="react" />
  </>
) : (
  <TableOfContentSkeleton />
)}
