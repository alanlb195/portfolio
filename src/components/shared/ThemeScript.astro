<script is:inline>
    function getPreferredTheme() {
        const storedTheme = localStorage.getItem("theme");
        const prefersDark = window.matchMedia(
            "(prefers-color-scheme: dark)",
        ).matches;
        return storedTheme === "dark" || (!storedTheme && prefersDark);
    }

    function applyTheme() {
        const shouldUseDark = getPreferredTheme();
        document.documentElement.classList.toggle("dark", shouldUseDark);
    }

    applyTheme();

    window
        .matchMedia("(prefers-color-scheme: dark)")
        .addEventListener("change", applyTheme);
    document.addEventListener("astro:after-swap", applyTheme);
</script>
